# 小程序真机调试配置说明

## 问题说明

真机调试时可能出现以下错误：
- `Error: not node js file system!path:/saaa_config.json`
- HTTP 503 错误
- 无法登录或网络请求失败

## 解决方案

### 1. 修改 API 地址（重要）

真机调试时，`localhost` 无法访问开发机器，需要修改为实际 IP 地址。

**步骤：**

1. 查看开发机器的 IP 地址：
   - Windows: 打开命令提示符，输入 `ipconfig`，找到 IPv4 地址
   - Mac/Linux: 打开终端，输入 `ifconfig` 或 `ip addr`，找到局域网 IP

2. 修改 `mini-program/config/index.js`：
   ```javascript
   const config = {
     // 注意：必须包含端口号 8080
     baseURL: 'http://192.168.1.108:8080/api',  // 替换为你的 IP
   };
   ```
   
   **重要：** baseURL 格式必须是 `http://IP地址:8080/api`，不能缺少端口号！

3. 确保开发机器和手机在同一局域网内

4. 确保后端服务正在运行，并且防火墙允许 8080 端口访问

### 2. 检查后端服务

确保后端服务正在运行：

1. 在浏览器访问：`http://192.168.1.108:8080/api/auth/login`（应该返回 405 方法不允许，说明服务正常）
2. 或者访问：`http://192.168.1.108:8080/swagger-ui.html`（如果配置了 Swagger）

### 3. 检查防火墙设置

**Windows:**
1. 打开"Windows Defender 防火墙"
2. 点击"高级设置"
3. 选择"入站规则" -> "新建规则"
4. 选择"端口" -> "TCP" -> "特定本地端口" -> 输入 `8080`
5. 允许连接

**Mac:**
```bash
# 允许 8080 端口
sudo pfctl -f /etc/pf.conf
```

### 4. 微信开发者工具设置

1. 打开微信开发者工具
2. 点击右上角"详情"
3. 在"本地设置"中：
   - ✅ 勾选"不校验合法域名、web-view（业务域名）、TLS 版本以及 HTTPS 证书"
   - ✅ 勾选"不校验安全域名"

### 5. 图片处理优化

已优化 `utils/image.js`，使用异步方式读取图片文件，避免真机上的同步问题。

### 6. 网络请求调试

如果仍然无法连接，可以：

1. 在真机上打开微信开发者工具的"调试"功能
2. 查看控制台错误信息
3. 确认 IP 地址是否正确
4. 确认后端服务是否可访问

## 常见问题

### Q: HTTP 503 错误
A: 
1. 检查 baseURL 是否包含端口号（必须是 `:8080`）
2. 检查后端服务是否正在运行
3. 检查防火墙是否允许 8080 端口
4. 检查手机和电脑是否在同一局域网

### Q: 真机上显示"网络请求失败"
A: 检查 `baseURL` 是否使用了正确的 IP 地址和端口号，确保手机和电脑在同一局域网。

### Q: 真机上出现文件系统错误
A: 已修复 `image.js` 中的文件读取方式，使用异步 API。

### Q: 模拟器正常，真机不行
A: 
1. 主要是 `localhost` 的问题，真机无法访问 `localhost`，必须使用实际 IP 地址
2. 确保 baseURL 包含端口号：`http://IP:8080/api`

## 调试步骤

1. **测试网络连接**：
   - 在手机浏览器访问：`http://192.168.1.108:8080/swagger-ui.html`
   - 如果无法访问，说明网络或防火墙有问题

2. **测试 API**：
   - 在手机浏览器访问：`http://192.168.1.108:8080/api/auth/login`
   - 应该返回 JSON 错误（405 方法不允许），说明服务正常

3. **查看小程序日志**：
   - 在微信开发者工具中查看"调试器" -> "Console"
   - 查看网络请求详情

## 开发建议

- **开发时**：使用模拟器，`baseURL` 可以保持 `http://localhost:8080/api`
- **真机调试时**：修改 `baseURL` 为实际 IP 地址：`http://IP:8080/api`
- **生产环境**：使用正式域名和 HTTPS
